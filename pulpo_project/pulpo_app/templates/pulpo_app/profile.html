{% extends 'base.html' %}
{% block title %}Perfil - {{ user.username }}{% endblock %}

{% block content %}
<div class="container">
    <div class="card profile-card">
        <h2>Mi perfil</h2>
        <div class="profile-info">
            <p><strong>Nombre de usuario:</strong> {{ user.username }}</p>
            <p><strong>Fecha de registro:</strong> {{ user.date_joined|date:"d/m/Y" }}</p>
            <p><strong>Última sesión:</strong> {{ user.last_login|date:"d/m/Y H:i" }}</p>
        </div>
        <form action="{% url 'logout' %}" method="post" class="logout-form">
            {% csrf_token %}
            <button type="submit" class="btn-logout">Cerrar sesión</button>
        </form>
    </div>

    <div class="card add-content-card">
        <h3>Agregar contenido</h3>
        <form method="post" action="" class="add-content-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="contenido_id">Seleccionar contenido:</label>
                <select id="contenido_id" name="contenido_id" required>
                    {% for contenido in contenidos %}
                    <option value="{{ contenido.id }}">{{ contenido.titulo }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="estado">Estado:</label>
                <select id="estado" name="estado">
                    <option value="PL">Planeado</option>
                    <option value="WT">En progreso</option>
                    <option value="CM">Completado</option>
                    <option value="AB">Abandonado</option>
                </select>
            </div>
            <button type="submit" class="btn-add-content">Agregar contenido</button>
        </form>
    </div>

    <div class="card user-content-card">
        <h3>Mis contenidos</h3>
        {% if lista_usuario %}
            <ul class="user-content-list">
                {% for item in lista_usuario %}
                <li class="user-content-item">
                    <div class="content-details">
                        <a href="/contenido/{{ item.contenido.id }}" class="content-title">
                            {{ item.contenido.titulo }}
                        </a>
                        {% if item.puntuacion %}
                            <span class="content-rating">Puntuación: {{ item.puntuacion }}</span>
                        {% endif %}
                    </div>
                    <div class="content-actions">
                        <form method="post" action="" class="content-status-form">
                            {% csrf_token %}
                            <input type="hidden" name="lista_usuario_id" value="{{ item.id }}">
                            <div class="form-group">
                                <label for="estado_{{ item.id }}">Estado:</label>
                                <select id="estado_{{ item.id }}" name="estado">
                                    <option value="PL" {% if item.estado == "PL" %}selected{% endif %}>Planeado</option>
                                    <option value="WT" {% if item.estado == "WT" %}selected{% endif %}>En progreso</option>
                                    <option value="CM" {% if item.estado == "CM" %}selected{% endif %}>Completado</option>
                                    <option value="AB" {% if item.estado == "AB" %}selected{% endif %}>Abandonado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn-save-changes">Guardar cambios</button>
                                <button type="submit" name="delete" value="true" class="btn-delete">Eliminar</button>
                            </div>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="no-content-message">No has agregado contenidos aún.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .profile-card .profile-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 16px;
    }

    .profile-card .logout-form {
        display: flex;
        justify-content: center;
        margin-top: 16px;
    }

    .add-content-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .user-content-list {
        list-style-type: none;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .user-content-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
    }

    .content-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .content-actions {
        display: flex;
        gap: 16px;
    }

    .content-status-form {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .btn-delete {
        background-color: #eb1e1e;
        margin-top: 8px;
    }

    .no-content-message {
        text-align: center;
        color: #666;
        font-style: italic;
    }

    @media (max-width: 600px) {
        .user-content-item {
            flex-direction: column;
            align-items: stretch;
            gap: 12px;
        }

        .content-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}